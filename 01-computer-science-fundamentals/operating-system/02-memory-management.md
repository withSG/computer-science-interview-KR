# 메모리 관리 전략: Stack vs Heap

## 학습 목표

- [ ] Stack과 Heap의 차이를 설명할 수 있다
- [ ] 메모리 누수의 원인과 해결책을 안다
- [ ] StackOverflow와 OutOfMemory 에러를 구분할 수 있다

---

## 1. Stack 영역

### 특성
- **컴파일 타임**에 크기 결정 (또는 런타임에 동적 확장)
- **LIFO (후입선출)** 구조
- **스레드마다 독립적**으로 할당
- 자동으로 메모리 할당/해제

### 저장되는 데이터
- 지역 변수
- 매개변수
- 함수 호출 정보 (리턴 주소)

### 장점
- 메모리 할당/해제가 빠름
- 동기화 문제 없음 (스레드 독립)

### 주의사항
```java
// StackOverflowError 예시
public void recursiveMethod() {
    recursiveMethod(); // 무한 재귀 → 스택 오버플로우
}
```

---

## 2. Heap 영역

### 특성
- **런타임**에 동적으로 할당
- 모든 스레드가 **공유**
- GC(가비지 컬렉터)가 메모리 관리 (Java)
- 수동 해제 필요 (C/C++)

### 저장되는 데이터
- 객체 인스턴스
- 동적 배열
- 전역적으로 접근 가능한 데이터

### 주의사항
```java
// OutOfMemoryError 예시
List<byte[]> list = new ArrayList<>();
while (true) {
    list.add(new byte[1024 * 1024]); // 1MB씩 계속 할당
}
```

---

## 3. Stack vs Heap 비교

| 구분 | Stack | Heap |
|------|-------|------|
| 할당 시점 | 컴파일 타임 | 런타임 |
| 크기 | 제한적 (보통 1MB) | 상대적으로 큼 |
| 속도 | 빠름 | 느림 |
| 관리 | 자동 | GC 또는 수동 |
| 스레드 | 독립적 | 공유 |
| 에러 | StackOverflowError | OutOfMemoryError |

---

## 4. 메모리 구조 시각화

```
┌───────────────────────────────────┐  높은 주소
│            Stack                  │
│    (지역변수, 함수호출정보)         │
│              ↓                    │
├───────────────────────────────────┤
│           (빈 공간)               │
├───────────────────────────────────┤
│              ↑                    │
│            Heap                   │
│       (동적 할당 객체)             │
├───────────────────────────────────┤
│            BSS                    │
│      (초기화되지 않은 전역변수)     │
├───────────────────────────────────┤
│            Data                   │
│       (초기화된 전역변수)          │
├───────────────────────────────────┤
│            Code                   │
│         (실행 코드)               │
└───────────────────────────────────┘  낮은 주소
```

---

## 5. 메모리 누수 (Memory Leak)

### 원인
1. 사용 완료된 객체 참조를 끊지 않음
2. 리스너/콜백 등록 후 해제하지 않음
3. 캐시에 데이터 무한 저장

### 해결책
1. **힙 덤프 분석**: MAT, VisualVM 등 도구 사용
2. **WeakReference 활용**: GC 대상이 될 수 있도록
3. **리소스 정리**: try-with-resources, finally 블록

---

## 연관 개념

- [프로세스와 스레드](./01-process-thread.md)
- [가비지 컬렉션](../../02-backend-engineering/java-fundamentals/03-garbage-collection.md)
