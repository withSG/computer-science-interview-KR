# 가상 메모리 (Virtual Memory)

## 학습 목표

- [ ] 가상 메모리의 개념과 필요성을 설명할 수 있다
- [ ] 페이지 교체 알고리즘을 이해한다
- [ ] TLB의 역할을 안다

---

## 1. 가상 메모리란?

### 정의
물리적 메모리 크기와 관계없이 프로세스에게 **큰 주소 공간**을 제공하는 기술

### 필요성
- 물리 메모리보다 큰 프로그램 실행
- 프로세스 간 메모리 격리
- 메모리 보호

---

## 2. 주소 변환

### 가상 주소 → 물리 주소

```
┌─────────────────┐
│   가상 주소      │
│  (프로세스가 사용) │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   페이지 테이블   │
│ (가상→물리 매핑)  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   물리 주소      │
│  (실제 RAM 위치)  │
└─────────────────┘
```

### 페이징 (Paging)
- 가상 메모리를 고정 크기 **페이지**로 분할
- 물리 메모리를 고정 크기 **프레임**으로 분할
- 일반적인 페이지 크기: 4KB

---

## 3. TLB (Translation Lookaside Buffer)

### 역할
페이지 테이블의 **캐시** 역할 (주소 변환 속도 향상)

### 동작 과정

```
가상 주소 접근
       │
       ▼
   TLB 조회
       │
   ┌───┴───┐
   │       │
Hit │       │ Miss
   │       │
   ▼       ▼
물리주소   페이지 테이블 조회
반환      → TLB 업데이트
          → 물리주소 반환
```

### 컨텍스트 스위칭과 TLB
- 프로세스 간 스위칭 시 TLB **플러시** 필요
- 스레드 간 스위칭 시 TLB **유지** (같은 주소 공간)

---

## 4. 페이지 폴트 (Page Fault)

### 발생 상황
요청한 페이지가 물리 메모리에 **없을 때** 발생

### 처리 과정
1. 페이지 폴트 인터럽트 발생
2. 디스크에서 해당 페이지 로드
3. 페이지 테이블 업데이트
4. 프로세스 재실행

---

## 5. 페이지 교체 알고리즘

### FIFO (First In First Out)
- 가장 오래된 페이지 교체
- 구현 간단, 성능 보통

### LRU (Least Recently Used)
- 가장 오래 사용되지 않은 페이지 교체
- 성능 좋음, 구현 복잡

### LFU (Least Frequently Used)
- 사용 빈도가 가장 낮은 페이지 교체

### 비교

| 알고리즘 | 장점 | 단점 |
|---------|------|------|
| FIFO | 구현 간단 | Belady's Anomaly |
| LRU | 성능 좋음 | 오버헤드 |
| LFU | 빈도 고려 | 최근성 무시 |

---

## 6. 스래싱 (Thrashing)

### 정의
페이지 폴트가 과도하게 발생하여 **CPU가 실제 작업보다 페이지 교체에 더 많은 시간**을 소비하는 현상

### 원인
- 너무 많은 프로세스
- 부족한 물리 메모리

### 해결책
- 메모리 증설
- 프로세스 수 제한
- Working Set 기법 적용

---

## 연관 개념

- [메모리 관리](./02-memory-management.md)
- [컨텍스트 스위칭](./03-context-switching.md)
