# 가상화와 Hypervisor

> 클라우드의 핵심 기술, 가상화의 원리

## 가상화(Virtualization)란?

가상화는 **물리적 하드웨어 리소스를 추상화**하여 여러 가상 환경을 생성하는 기술입니다.

```
┌─────────────────────────────────────────┐
│            물리 서버 (1대)               │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │  VM 1   │ │  VM 2   │ │  VM 3   │   │
│  │ Ubuntu  │ │ CentOS  │ │ Windows │   │
│  └─────────┘ └─────────┘ └─────────┘   │
│                                         │
│            Hypervisor                   │
│          (가상화 계층)                   │
│                                         │
│    Hardware (CPU, Memory, Storage)      │
└─────────────────────────────────────────┘
```

## 가상화의 종류

### 1. 서버 가상화 (Server Virtualization)
- 하나의 물리 서버에서 여러 OS 실행
- VMware, VirtualBox, KVM, Hyper-V

### 2. 네트워크 가상화 (Network Virtualization)
- 물리 네트워크를 논리적으로 분리
- VLAN, VPN, SDN (Software Defined Networking)

### 3. 스토리지 가상화 (Storage Virtualization)
- 여러 물리 스토리지를 하나로 통합
- SAN, NAS, Software Defined Storage

---

## Hypervisor란?

Hypervisor는 **가상 머신을 생성하고 관리하는 소프트웨어**로, Virtual Machine Monitor(VMM)라고도 합니다.

### Type 1: Bare-metal Hypervisor

```
┌─────────┐ ┌─────────┐ ┌─────────┐
│  VM 1   │ │  VM 2   │ │  VM 3   │
└────┬────┘ └────┬────┘ └────┬────┘
     │           │           │
┌────┴───────────┴───────────┴────┐
│         Type 1 Hypervisor        │
│   (ESXi, Hyper-V, KVM, Xen)     │
└──────────────┬──────────────────┘
               │
┌──────────────┴──────────────────┐
│           Hardware              │
└─────────────────────────────────┘
```

**특징:**
- 하드웨어 위에 직접 설치
- 호스트 OS 불필요
- 높은 성능, 낮은 오버헤드
- 엔터프라이즈/데이터센터용

**대표 제품:**
| 제품 | 벤더 | 특징 |
|------|------|------|
| VMware ESXi | VMware | 기업용 표준 |
| Microsoft Hyper-V | Microsoft | Windows Server 내장 |
| KVM | 오픈소스 | Linux 커널 내장 |
| Xen | 오픈소스/Citrix | AWS EC2 초기 사용 |

### Type 2: Hosted Hypervisor

```
┌─────────┐ ┌─────────┐
│  VM 1   │ │  VM 2   │
└────┬────┘ └────┬────┘
     │           │
┌────┴───────────┴────┐
│  Type 2 Hypervisor  │
│ (VirtualBox, VMware │
│  Workstation)       │
└──────────┬──────────┘
           │
┌──────────┴──────────┐
│      Host OS        │
│  (Windows, macOS)   │
└──────────┬──────────┘
           │
┌──────────┴──────────┐
│      Hardware       │
└─────────────────────┘
```

**특징:**
- 기존 OS 위에 설치
- 설치 및 사용 간편
- 개발/테스트 환경에 적합
- Type 1 대비 오버헤드 존재

**대표 제품:**
| 제품 | 용도 |
|------|------|
| VirtualBox | 무료, 크로스플랫폼 |
| VMware Workstation | Windows/Linux 개발 |
| VMware Fusion | macOS 개발 |
| Parallels Desktop | macOS용 Windows 실행 |

---

## Type 1 vs Type 2 비교

| 구분 | Type 1 (Bare-metal) | Type 2 (Hosted) |
|------|---------------------|-----------------|
| 설치 위치 | 하드웨어 직접 | 호스트 OS 위 |
| 성능 | 높음 (거의 Native) | 중간 (OS 오버헤드) |
| 보안 | 높음 (공격 표면 적음) | 낮음 |
| 관리 | 복잡 | 간단 |
| 용도 | 프로덕션, 데이터센터 | 개발, 테스트 |
| 비용 | 높음 (라이선스) | 낮음/무료 |

---

## 전가상화 vs 반가상화

### 전가상화 (Full Virtualization)

```
Guest OS는 가상 환경임을 모름
모든 하드웨어를 에뮬레이션

장점: Guest OS 수정 불필요
단점: 오버헤드 존재

예: VMware, VirtualBox
```

### 반가상화 (Paravirtualization)

```
Guest OS가 Hypervisor와 직접 통신
수정된 Guest OS 필요

장점: 높은 성능
단점: OS 수정 필요

예: Xen (PV 모드)
```

### 하드웨어 지원 가상화

```
CPU가 가상화 지원 (Intel VT-x, AMD-V)
전가상화 성능 향상

현대 대부분의 가상화가 하드웨어 지원 사용
```

---

## 가상화 vs 컨테이너

```
가상화 (VM):                    컨테이너:
┌─────────┐ ┌─────────┐        ┌─────────┐ ┌─────────┐
│  App A  │ │  App B  │        │  App A  │ │  App B  │
├─────────┤ ├─────────┤        ├─────────┤ ├─────────┤
│ Guest OS│ │ Guest OS│        │  Bins   │ │  Bins   │
└────┬────┘ └────┬────┘        └────┬────┘ └────┬────┘
┌────┴───────────┴────┐        ┌────┴───────────┴────┐
│     Hypervisor      │        │   Container Engine  │
└──────────┬──────────┘        │      (Docker)       │
┌──────────┴──────────┐        └──────────┬──────────┘
│      Host OS        │        ┌──────────┴──────────┐
└──────────┬──────────┘        │       Host OS       │
┌──────────┴──────────┐        └──────────┬──────────┘
│      Hardware       │        ┌──────────┴──────────┐
└─────────────────────┘        │       Hardware      │
                               └─────────────────────┘
```

| 구분 | VM | Container |
|------|-----|-----------|
| 격리 수준 | 완전 격리 (OS 분리) | 프로세스 격리 |
| 부팅 시간 | 분 단위 | 초 단위 |
| 리소스 | GB 단위 | MB 단위 |
| 이식성 | 제한적 | 높음 |
| 보안 | 높음 | 상대적 낮음 |
| 사용 사례 | 다른 OS 실행 | 마이크로서비스 |

---

## 클라우드에서의 가상화

### AWS EC2
- 초기: Xen 기반
- 현재: Nitro (KVM 기반 커스텀 하이퍼바이저)

### Azure
- Hyper-V 기반

### GCP
- KVM 기반

---

## 면접 예상 질문

1. **"Type 1과 Type 2 Hypervisor의 차이는?"**
2. **"가상화와 컨테이너의 차이점은?"**
3. **"전가상화와 반가상화의 차이는?"**
4. **"AWS EC2는 어떤 가상화 기술을 사용하나요?"**
